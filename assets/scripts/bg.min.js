var BG=function(a){var b="https://www.bookgrail.com",c="",d=function(){a("*[data-cart-add]").click(function(){var b=a(this).data("cart-add"),c=a(this).data("cart-open");if("undefined"!=typeof c){var d=a(this).data("theme-color"),e=a(this).data("book-message"),h=function(){g(a(c),d,e)};f(b,h)}else f(b)}),a("*[data-cart-open]").click(function(){"undefined"==typeof a(this).data("cart-add")&&(selector=a(this).data("cart-open"),g(a(selector),a(this).data("theme-color"),a(this).data("book-message")))}),a("*[data-cart-close]").click(function(){selector=a(this).data("cart-close"),container=a(selector),container.length>0&&(container.css("display","none"),container.find("iframe").remove())})},e=function(){a("*[data-price]").each(function(){var c=a(this);c.html("Loading..."),isbn=a(this).data("price"),data={action:"muse_price",isbn:isbn},a.getJSON(b+"/wp-admin/admin-ajax.php?callback=?",data).always(function(){c.html(price)})})},f=function(d,e){if(data={action:"muse_add_to_cart",isbn:d,ref_key:c},e&&"function"==typeof e){var f=a.getJSON(b+"/wp-admin/admin-ajax.php?callback=?",data);f.always(e)}else a.getJSON(b+"/wp-admin/admin-ajax.php?callback=?",data)},g=function(a,d,e){d=d||"",e=e||"",a.length>0&&(0==a.find("iframe").length&&a.append('<iframe width="400" height="602" style="border:none;" src=""></iframe>'),frame_url=b+"/mini-cart/?rand="+Math.round(1e7*Math.random())+"&ref_key="+c,d.length>0&&(frame_url+="&theme-color="+encodeURIComponent(d)),e.length>0&&(frame_url+="&book-message="+encodeURIComponent(e)),a.find("iframe").attr("src",frame_url)),a.css("display","table")};return{init:function(a){c=a,d(),e()},server:function(a){b=a}}}(jQuery);BG.init(bookgrail_params.referrer_id);